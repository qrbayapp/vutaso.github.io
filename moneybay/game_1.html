<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE ULTIMATE GAME - Tr√≤ Ch∆°i Ph·ª©c T·∫°p Nh·∫•t Th·∫ø Gi·ªõi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            color: white;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Main Menu */
        #mainMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 50px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        #mainMenu h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }

        @keyframes gradient {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(360deg); }
        }

        .menu-button {
            margin: 10px;
            padding: 15px 40px;
            font-size: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .menu-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
        }

        /* Game Canvas */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            background: #000;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
            pointer-events: none;
        }

        .stat-panel {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .stat {
            margin: 5px 0;
            font-size: 16px;
        }

        .progress-bar {
            width: 200px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .health-bar { background: linear-gradient(90deg, #ff6b6b, #ff8787); }
        .mana-bar { background: linear-gradient(90deg, #4ecdc4, #45b7d1); }
        .exp-bar { background: linear-gradient(90deg, #ffd93d, #ffb800); }

        /* Inventory */
        #inventory {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .inventory-slot {
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .inventory-slot:hover {
            transform: scale(1.1);
            border-color: #4ecdc4;
        }

        .inventory-slot.active {
            border-color: #ffd93d;
            box-shadow: 0 0 20px #ffd93d;
        }

        /* Minimap */
        #minimap {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #667eea;
            border-radius: 10px;
            z-index: 100;
        }

        /* Chat */
        #chat {
            position: absolute;
            bottom: 100px;
            left: 20px;
            width: 400px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            overflow-y: auto;
            z-index: 100;
        }

        .chat-message {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 14px;
        }

        /* Skill Bar */
        #skillBar {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .skill-slot {
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #764ba2;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            position: relative;
        }

        .skill-cooldown {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Quest Log */
        #questLog {
            position: absolute;
            top: 100px;
            right: 20px;
            width: 300px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            z-index: 100;
            max-height: 400px;
            overflow-y: auto;
        }

        .quest-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border-left: 4px solid #4ecdc4;
        }

        .quest-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .quest-progress {
            font-size: 12px;
            color: #ffd93d;
        }

        /* Particle Effects */
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loader {
            width: 100px;
            height: 100px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hidden by default */
        .hidden {
            display: none !important;
        }

        /* Damage Numbers */
        .damage-number {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            pointer-events: none;
            animation: damageFloat 1s ease-out forwards;
        }

        @keyframes damageFloat {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* Achievement Popup */
        #achievementPopup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #ffd93d;
            text-align: center;
            z-index: 2000;
            transition: transform 0.5s;
        }

        #achievementPopup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        /* Boss Health Bar */
        #bossHealthBar {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }

        .boss-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .boss-health-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
        }

        .boss-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff6b6b);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div class="loader"></div>
        <h2 style="margin-top: 20px;">Loading Ultimate Game...</h2>
        <p id="loadingText">0%</p>
    </div>

    <div id="gameContainer">
        <!-- Main Menu -->
        <div id="mainMenu">
            <h1>THE ULTIMATE GAME</h1>
            <p style="margin-bottom: 30px;">Tr√≤ Ch∆°i Ph·ª©c T·∫°p Nh·∫•t Th·∫ø Gi·ªõi</p>
            <button class="menu-button" onclick="game.startGame()">üéÆ B·∫Øt ƒê·∫ßu</button>
            <button class="menu-button" onclick="game.showControls()">‚å®Ô∏è ƒêi·ªÅu Khi·ªÉn</button>
            <button class="menu-button" onclick="game.showSettings()">‚öôÔ∏è C√†i ƒê·∫∑t</button>
            <button class="menu-button" onclick="game.showLeaderboard()">üèÜ B·∫£ng X·∫øp H·∫°ng</button>
        </div>

        <!-- Game Canvas -->
        <canvas id="gameCanvas" class="hidden"></canvas>

        <!-- HUD -->
        <div id="hud" class="hidden">
            <div class="stat-panel">
                <div class="stat">‚ù§Ô∏è HP: <span id="currentHP">100</span>/<span id="maxHP">100</span></div>
                <div class="progress-bar">
                    <div id="healthBar" class="progress-fill health-bar" style="width: 100%"></div>
                </div>
                
                <div class="stat">‚ú® MP: <span id="currentMP">50</span>/<span id="maxMP">50</span></div>
                <div class="progress-bar">
                    <div id="manaBar" class="progress-fill mana-bar" style="width: 100%"></div>
                </div>
                
                <div class="stat">‚≠ê Level: <span id="level">1</span></div>
                <div class="progress-bar">
                    <div id="expBar" class="progress-fill exp-bar" style="width: 0%"></div>
                </div>
                <div class="stat" style="font-size: 12px;">EXP: <span id="currentExp">0</span>/<span id="maxExp">100</span></div>
            </div>

            <div class="stat-panel">
                <div class="stat">üí∞ Gold: <span id="gold">0</span></div>
                <div class="stat">‚öîÔ∏è Attack: <span id="attack">10</span></div>
                <div class="stat">üõ°Ô∏è Defense: <span id="defense">5</span></div>
                <div class="stat">üèÉ Speed: <span id="speed">5</span></div>
                <div class="stat">üéØ Score: <span id="score">0</span></div>
            </div>
        </div>

        <!-- Boss Health Bar -->
        <div id="bossHealthBar" class="hidden">
            <div class="boss-name" id="bossName">Boss Name</div>
            <div class="boss-health-bar">
                <div id="bossHealthFill" class="boss-health-fill" style="width: 100%"></div>
            </div>
        </div>

        <!-- Inventory -->
        <div id="inventory" class="hidden">
            <div class="inventory-slot active" data-slot="0">‚öîÔ∏è</div>
            <div class="inventory-slot" data-slot="1">üèπ</div>
            <div class="inventory-slot" data-slot="2">üîÆ</div>
            <div class="inventory-slot" data-slot="3">üíä</div>
            <div class="inventory-slot" data-slot="4">üó°Ô∏è</div>
        </div>

        <!-- Skill Bar -->
        <div id="skillBar" class="hidden">
            <div class="skill-slot" data-skill="0">üî•</div>
            <div class="skill-slot" data-skill="1">‚ùÑÔ∏è</div>
            <div class="skill-slot" data-skill="2">‚ö°</div>
            <div class="skill-slot" data-skill="3">üíö</div>
            <div class="skill-slot" data-skill="4">üå™Ô∏è</div>
        </div>

        <!-- Minimap -->
        <canvas id="minimap" class="hidden"></canvas>

        <!-- Quest Log -->
        <div id="questLog" class="hidden">
            <h3 style="margin-bottom: 10px;">üìú Quest Log</h3>
            <div id="questList"></div>
        </div>

        <!-- Chat -->
        <div id="chat" class="hidden">
            <div id="chatMessages"></div>
        </div>

        <!-- Achievement Popup -->
        <div id="achievementPopup">
            <h2>üèÜ Achievement Unlocked!</h2>
            <h3 id="achievementTitle"></h3>
            <p id="achievementDesc"></p>
        </div>
    </div>

    <script>
        // ==================== THE ULTIMATE GAME ENGINE ====================
        
        class UltimateGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.minimap = document.getElementById('minimap');
                this.minimapCtx = this.minimap.getContext('2d');
                
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.minimap.width = 200;
                this.minimap.height = 200;
                
                this.isRunning = false;
                this.lastTime = 0;
                this.deltaTime = 0;
                
                this.initializeGame();
                this.setupEventListeners();
                this.simulateLoading();
            }
            
            initializeGame() {
                // Player
                this.player = {
                    x: 400,
                    y: 300,
                    width: 30,
                    height: 30,
                    speed: 5,
                    hp: 100,
                    maxHp: 100,
                    mp: 50,
                    maxMp: 50,
                    level: 1,
                    exp: 0,
                    maxExp: 100,
                    gold: 0,
                    attack: 10,
                    defense: 5,
                    score: 0,
                    inventory: ['‚öîÔ∏è', 'üèπ', 'üîÆ', 'üíä', 'üó°Ô∏è'],
                    selectedSlot: 0,
                    velocity: { x: 0, y: 0 },
                    facing: 'right',
                    isAttacking: false,
                    attackCooldown: 0,
                    invulnerable: false,
                    invulnerableTime: 0
                };
                
                // World
                this.world = {
                    width: 3000,
                    height: 2000,
                    gravity: 0.5,
                    friction: 0.9
                };
                
                // Camera
                this.camera = {
                    x: 0,
                    y: 0,
                    shake: 0
                };
                
                // Game state
                this.keys = {};
                this.mouse = { x: 0, y: 0, down: false };
                this.enemies = [];
                this.projectiles = [];
                this.particles = [];
                this.items = [];
                this.obstacles = [];
                this.bosses = [];
                this.npcs = [];
                
                // Quests
                this.quests = [
                    { id: 1, title: 'Defeat 10 Enemies', progress: 0, target: 10, complete: false },
                    { id: 2, title: 'Collect 100 Gold', progress: 0, target: 100, complete: false },
                    { id: 3, title: 'Reach Level 5', progress: 1, target: 5, complete: false }
                ];
                
                // Skills
                this.skills = [
                    { id: 0, name: 'Fireball', cooldown: 0, maxCooldown: 2000, manaCost: 10, emoji: 'üî•' },
                    { id: 1, name: 'Ice Shard', cooldown: 0, maxCooldown: 1500, manaCost: 8, emoji: '‚ùÑÔ∏è' },
                    { id: 2, name: 'Lightning', cooldown: 0, maxCooldown: 3000, manaCost: 15, emoji: '‚ö°' },
                    { id: 3, name: 'Heal', cooldown: 0, maxCooldown: 5000, manaCost: 20, emoji: 'üíö' },
                    { id: 4, name: 'Tornado', cooldown: 0, maxCooldown: 4000, manaCost: 25, emoji: 'üå™Ô∏è' }
                ];
                
                // Achievements
                this.achievements = [
                    { id: 1, name: 'First Blood', desc: 'Defeat your first enemy', unlocked: false },
                    { id: 2, name: 'Rich', desc: 'Collect 500 gold', unlocked: false },
                    { id: 3, name: 'Level Up', desc: 'Reach level 10', unlocked: false },
                    { id: 4, name: 'Boss Slayer', desc: 'Defeat a boss', unlocked: false },
                    { id: 5, name: 'Collector', desc: 'Collect 50 items', unlocked: false }
                ];
                
                // Generate initial world
                this.generateWorld();
            }
            
            generateWorld() {
                // Generate obstacles
                for (let i = 0; i < 50; i++) {
                    this.obstacles.push({
                        x: Math.random() * this.world.width,
                        y: Math.random() * this.world.height,
                        width: 40 + Math.random() * 60,
                        height: 40 + Math.random() * 60,
                        type: Math.random() > 0.5 ? 'rock' : 'tree'
                    });
                }
                
                // Generate items
                for (let i = 0; i < 30; i++) {
                    this.items.push({
                        x: Math.random() * this.world.width,
                        y: Math.random() * this.world.height,
                        type: ['üí∞', 'üíé', '‚≠ê', 'üíä'][Math.floor(Math.random() * 4)],
                        value: 10 + Math.floor(Math.random() * 40)
                    });
                }
                
                // Generate enemies
                for (let i = 0; i < 20; i++) {
                    this.spawnEnemy();
                }
                
                // Generate NPCs
                for (let i = 0; i < 5; i++) {
                    this.npcs.push({
                        x: Math.random() * this.world.width,
                        y: Math.random() * this.world.height,
                        type: ['üßô', 'ü§¥', 'üë∏', 'üßù'][Math.floor(Math.random() * 4)],
                        dialogue: [
                            'Welcome, traveler!',
                            'Beware of the darkness...',
                            'The boss awaits you!',
                            'Collect more power!'
                        ]
                    });
                }
                
                // Spawn first boss after 30 seconds
                setTimeout(() => this.spawnBoss(), 30000);
            }
            
            spawnEnemy() {
                const enemy = {
                    x: Math.random() * this.world.width,
                    y: Math.random() * this.world.height,
                    width: 25,
                    height: 25,
                    hp: 30 + this.player.level * 10,
                    maxHp: 30 + this.player.level * 10,
                    speed: 2 + Math.random(),
                    damage: 5 + this.player.level * 2,
                    type: ['üëæ', 'üëπ', 'üëø', 'üíÄ'][Math.floor(Math.random() * 4)],
                    ai: 'chase',
                    attackCooldown: 0
                };
                this.enemies.push(enemy);
            }
            
            spawnBoss() {
                const boss = {
                    x: this.world.width / 2,
                    y: this.world.height / 2,
                    width: 80,
                    height: 80,
                    hp: 1000 + this.player.level * 500,
                    maxHp: 1000 + this.player.level * 500,
                    speed: 3,
                    damage: 20 + this.player.level * 5,
                    type: 'üêâ',
                    name: 'Dragon Boss',
                    phase: 1,
                    attackPattern: 0,
                    attackCooldown: 0
                };
                this.bosses.push(boss);
                this.showBossHealthBar(boss);
                this.addChatMessage('‚ö†Ô∏è A boss has appeared!');
            }
            
            setupEventListeners() {
                // Keyboard
                window.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    
                    // Number keys for inventory
                    if (e.key >= '1' && e.key <= '5') {
                        this.selectInventorySlot(parseInt(e.key) - 1);
                    }
                    
                    // Q,E,R,F,G for skills
                    const skillKeys = { 'q': 0, 'e': 1, 'r': 2, 'f': 3, 'g': 4 };
                    if (skillKeys[e.key.toLowerCase()] !== undefined) {
                        this.useSkill(skillKeys[e.key.toLowerCase()]);
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // Mouse
                this.canvas.addEventListener('mousemove', (e) => {
                    this.mouse.x = e.clientX;
                    this.mouse.y = e.clientY;
                });
                
                this.canvas.addEventListener('mousedown', () => {
                    this.mouse.down = true;
                    this.attack();
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.mouse.down = false;
                });
                
                // Inventory clicks
                document.querySelectorAll('.inventory-slot').forEach((slot, index) => {
                    slot.addEventListener('click', () => this.selectInventorySlot(index));
                });
                
                // Skill clicks
                document.querySelectorAll('.skill-slot').forEach((slot, index) => {
                    slot.addEventListener('click', () => this.useSkill(index));
                });
                
                // Resize
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }
            
            simulateLoading() {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        setTimeout(() => {
                            document.getElementById('loadingScreen').classList.add('hidden');
                        }, 500);
                    }
                    document.getElementById('loadingText').textContent = Math.floor(progress) + '%';
                }, 200);
            }
            
            startGame() {
                document.getElementById('mainMenu').classList.add('hidden');
                document.getElementById('gameCanvas').classList.remove('hidden');
                document.getElementById('hud').classList.remove('hidden');
                document.getElementById('inventory').classList.remove('hidden');
                document.getElementById('skillBar').classList.remove('hidden');
                document.getElementById('minimap').classList.remove('hidden');
                document.getElementById('questLog').classList.remove('hidden');
                document.getElementById('chat').classList.remove('hidden');
                
                this.isRunning = true;
                this.addChatMessage('üéÆ Game Started! Use WASD to move, Click to attack!');
                this.addChatMessage('üí° Press Q,E,R,F,G for skills!');
                this.updateQuestLog();
                this.gameLoop(0);
            }
            
            gameLoop(timestamp) {
                if (!this.isRunning) return;
                
                this.deltaTime = timestamp - this.lastTime;
                this.lastTime = timestamp;
                
                this.update(this.deltaTime);
                this.render();
                
                requestAnimationFrame((t) => this.gameLoop(t));
            }
            
            update(dt) {
                // Update player
                this.updatePlayer(dt);
                
                // Update enemies
                this.updateEnemies(dt);
                
                // Update bosses
                this.updateBosses(dt);
                
                // Update projectiles
                this.updateProjectiles(dt);
                
                // Update particles
                this.updateParticles(dt);
                
                // Update skills cooldown
                this.updateSkills(dt);
                
                // Update camera
                this.updateCamera();
                
                // Check collisions
                this.checkCollisions();
                
                // Update timers
                if (this.player.attackCooldown > 0) this.player.attackCooldown -= dt;
                if (this.player.invulnerableTime > 0) this.player.invulnerableTime -= dt;
                if (this.player.invulnerableTime <= 0) this.player.invulnerable = false;
                
                // Regen mana
                if (this.player.mp < this.player.maxMp) {
                    this.player.mp += 0.01;
                    this.updateHUD();
                }
                
                // Spawn more enemies
                if (this.enemies.length < 15 && Math.random() < 0.01) {
                    this.spawnEnemy();
                }
            }
            
            updatePlayer(dt) {
                // Movement
                let dx = 0, dy = 0;
                if (this.keys['w'] || this.keys['arrowup']) dy -= 1;
                if (this.keys['s'] || this.keys['arrowdown']) dy += 1;
                if (this.keys['a'] || this.keys['arrowleft']) dx -= 1;
                if (this.keys['d'] || this.keys['arrowright']) dx += 1;
                
                // Normalize diagonal movement
                if (dx !== 0 && dy !== 0) {
                    dx *= 0.707;
                    dy *= 0.707;
                }
                
                this.player.x += dx * this.player.speed;
                this.player.y += dy * this.player.speed;
                
                // Update facing direction
                if (dx !== 0) this.player.facing = dx > 0 ? 'right' : 'left';
                
                // Keep player in bounds
                this.player.x = Math.max(15, Math.min(this.world.width - 15, this.player.x));
                this.player.y = Math.max(15, Math.min(this.world.height - 15, this.player.y));
            }
            
            updateEnemies(dt) {
                this.enemies.forEach((enemy, index) => {
                    // AI
                    const dx = this.player.x - enemy.x;
                    const dy = this.player.y - enemy.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < 300) {
                        enemy.x += (dx / dist) * enemy.speed;
                        enemy.y += (dy / dist) * enemy.speed;
                        
                        // Attack player
                        if (dist < 40 && enemy.attackCooldown <= 0) {
                            this.damagePlayer(enemy.damage);
                            enemy.attackCooldown = 1000;
                        }
                    }
                    
                    if (enemy.attackCooldown > 0) enemy.attackCooldown -= dt;
                    
                    // Remove dead enemies
                    if (enemy.hp <= 0) {
                        this.onEnemyKilled(enemy);
                        this.enemies.splice(index, 1);
                    }
                });
            }
            
            updateBosses(dt) {
                this.bosses.forEach((boss, index) => {
                    // Boss AI
                    const dx = this.player.x - boss.x;
                    const dy = this.player.y - boss.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    // Movement
                    if (dist > 100) {
                        boss.x += (dx / dist) * boss.speed;
                        boss.y += (dy / dist) * boss.speed;
                    }
                    
                    // Attack patterns
                    if (boss.attackCooldown <= 0) {
                        this.bossAttack(boss);
                        boss.attackCooldown = 2000;
                    } else {
                        boss.attackCooldown -= dt;
                    }
                    
                    // Phase transitions
                    const hpPercent = boss.hp / boss.maxHp;
                    if (hpPercent < 0.5 && boss.phase === 1) {
                        boss.phase = 2;
                        boss.speed += 1;
                        this.addChatMessage('‚ö†Ô∏è Boss entered Phase 2!');
                        this.createParticleExplosion(boss.x, boss.y, 30, '#ff0000');
                    }
                    
                    // Remove dead boss
                    if (boss.hp <= 0) {
                        this.onBossKilled(boss);
                        this.bosses.splice(index, 1);
                        document.getElementById('bossHealthBar').classList.add('hidden');
                    } else {
                        this.updateBossHealthBar(boss);
                    }
                });
            }
            
            bossAttack(boss) {
                const pattern = Math.floor(Math.random() * 3);
                
                switch(pattern) {
                    case 0: // Spray projectiles
                        for (let i = 0; i < 8; i++) {
                            const angle = (Math.PI * 2 / 8) * i;
                            this.projectiles.push({
                                x: boss.x,
                                y: boss.y,
                                vx: Math.cos(angle) * 5,
                                vy: Math.sin(angle) * 5,
                                damage: boss.damage,
                                type: 'üí•',
                                owner: 'boss'
                            });
                        }
                        break;
                    case 1: // Aimed shot
                        const dx = this.player.x - boss.x;
                        const dy = this.player.y - boss.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        this.projectiles.push({
                            x: boss.x,
                            y: boss.y,
                            vx: (dx / dist) * 8,
                            vy: (dy / dist) * 8,
                            damage: boss.damage * 2,
                            type: 'üî¥',
                            owner: 'boss'
                        });
                        break;
                    case 2: // Melee attack
                        if (Math.hypot(this.player.x - boss.x, this.player.y - boss.y) < 100) {
                            this.damagePlayer(boss.damage * 1.5);
                            this.camera.shake = 10;
                        }
                        break;
                }
            }
            
            updateProjectiles(dt) {
                this.projectiles.forEach((proj, index) => {
                    proj.x += proj.vx;
                    proj.y += proj.vy;
                    
                    // Remove out of bounds
                    if (proj.x < 0 || proj.x > this.world.width || 
                        proj.y < 0 || proj.y > this.world.height) {
                        this.projectiles.splice(index, 1);
                    }
                });
            }
            
            updateParticles(dt) {
                this.particles.forEach((particle, index) => {
                    particle.life -= dt;
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.1; // Gravity
                    particle.alpha -= dt / particle.maxLife;
                    
                    if (particle.life <= 0) {
                        this.particles.splice(index, 1);
                    }
                });
            }
            
            updateSkills(dt) {
                this.skills.forEach((skill, index) => {
                    if (skill.cooldown > 0) {
                        skill.cooldown -= dt;
                        const slot = document.querySelector(`[data-skill="${index}"]`);
                        const cdDisplay = slot.querySelector('.skill-cooldown');
                        if (!cdDisplay) {
                            const div = document.createElement('div');
                            div.className = 'skill-cooldown';
                            slot.appendChild(div);
                        }
                        slot.querySelector('.skill-cooldown').textContent = 
                            Math.ceil(skill.cooldown / 1000);
                    } else {
                        const cdDisplay = document.querySelector(`[data-skill="${index}"] .skill-cooldown`);
                        if (cdDisplay) cdDisplay.remove();
                    }
                });
            }
            
            updateCamera() {
                this.camera.x = this.player.x - this.canvas.width / 2;
                this.camera.y = this.player.y - this.canvas.height / 2;
                
                // Camera bounds
                this.camera.x = Math.max(0, Math.min(this.world.width - this.canvas.width, this.camera.x));
                this.camera.y = Math.max(0, Math.min(this.world.height - this.canvas.height, this.camera.y));
                
                // Camera shake
                if (this.camera.shake > 0) {
                    this.camera.x += (Math.random() - 0.5) * this.camera.shake;
                    this.camera.y += (Math.random() - 0.5) * this.camera.shake;
                    this.camera.shake *= 0.9;
                }
            }
            
            checkCollisions() {
                // Player vs Items
                this.items.forEach((item, index) => {
                    if (this.checkCollision(this.player, item, 30)) {
                        this.collectItem(item);
                        this.items.splice(index, 1);
                    }
                });
                
                // Player vs Enemies
                this.enemies.forEach(enemy => {
                    if (this.checkCollision(this.player, enemy, 35) && !this.player.invulnerable) {
                        // Handled in updateEnemies
                    }
                });
                
                // Projectiles vs Enemies
                this.projectiles.forEach((proj, pIndex) => {
                    if (proj.owner === 'player') {
                        this.enemies.forEach(enemy => {
                            if (this.checkCollision(proj, enemy, 20)) {
                                this.damageEnemy(enemy, proj.damage);
                                this.projectiles.splice(pIndex, 1);
                            }
                        });
                        
                        this.bosses.forEach(boss => {
                            if (this.checkCollision(proj, boss, 40)) {
                                this.damageBoss(boss, proj.damage);
                                this.projectiles.splice(pIndex, 1);
                            }
                        });
                    } else if (proj.owner === 'boss') {
                        if (this.checkCollision(proj, this.player, 20)) {
                            this.damagePlayer(proj.damage);
                            this.projectiles.splice(pIndex, 1);
                        }
                    }
                });
            }
            
            checkCollision(a, b, range) {
                const dx = a.x - b.x;
                const dy = a.y - b.y;
                return Math.sqrt(dx * dx + dy * dy) < range;
            }
            
            attack() {
                if (this.player.attackCooldown > 0) return;
                
                const angle = Math.atan2(
                    this.mouse.y - this.canvas.height / 2,
                    this.mouse.x - this.canvas.width / 2
                );
                
                this.projectiles.push({
                    x: this.player.x,
                    y: this.player.y,
                    vx: Math.cos(angle) * 10,
                    vy: Math.sin(angle) * 10,
                    damage: this.player.attack,
                    type: this.player.inventory[this.player.selectedSlot],
                    owner: 'player'
                });
                
                this.player.attackCooldown = 300;
                this.createParticles(this.player.x, this.player.y, 5, this.player.inventory[this.player.selectedSlot]);
            }
            
            useSkill(index) {
                const skill = this.skills[index];
                if (skill.cooldown > 0) return;
                if (this.player.mp < skill.manaCost) {
                    this.addChatMessage('‚ùå Not enough mana!');
                    return;
                }
                
                this.player.mp -= skill.manaCost;
                skill.cooldown = skill.maxCooldown;
                
                switch(index) {
                    case 0: // Fireball
                        this.castFireball();
                        break;
                    case 1: // Ice Shard
                        this.castIceShard();
                        break;
                    case 2: // Lightning
                        this.castLightning();
                        break;
                    case 3: // Heal
                        this.castHeal();
                        break;
                    case 4: // Tornado
                        this.castTornado();
                        break;
                }
                
                this.updateHUD();
            }
            
            castFireball() {
                const angle = Math.atan2(
                    this.mouse.y - this.canvas.height / 2,
                    this.mouse.x - this.canvas.width / 2
                );
                
                for (let i = 0; i < 3; i++) {
                    const spread = (i - 1) * 0.2;
                    this.projectiles.push({
                        x: this.player.x,
                        y: this.player.y,
                        vx: Math.cos(angle + spread) * 8,
                        vy: Math.sin(angle + spread) * 8,
                        damage: this.player.attack * 2,
                        type: 'üî•',
                        owner: 'player'
                    });
                }
                this.createParticleExplosion(this.player.x, this.player.y, 10, '#ff6b00');
            }
            
            castIceShard() {
                for (let i = 0; i < 8; i++) {
                    const angle = (Math.PI * 2 / 8) * i;
                    this.projectiles.push({
                        x: this.player.x,
                        y: this.player.y,
                        vx: Math.cos(angle) * 6,
                        vy: Math.sin(angle) * 6,
                        damage: this.player.attack * 1.5,
                        type: '‚ùÑÔ∏è',
                        owner: 'player'
                    });
                }
                this.createParticleExplosion(this.player.x, this.player.y, 15, '#00d4ff');
            }
            
            castLightning() {
                this.enemies.forEach(enemy => {
                    const dist = Math.hypot(enemy.x - this.player.x, enemy.y - this.player.y);
                    if (dist < 200) {
                        this.damageEnemy(enemy, this.player.attack * 3);
                        this.createParticleExplosion(enemy.x, enemy.y, 8, '#ffff00');
                    }
                });
                this.bosses.forEach(boss => {
                    const dist = Math.hypot(boss.x - this.player.x, boss.y - this.player.y);
                    if (dist < 200) {
                        this.damageBoss(boss, this.player.attack * 3);
                    }
                });
                this.camera.shake = 5;
            }
            
            castHeal() {
                this.player.hp = Math.min(this.player.maxHp, this.player.hp + 30);
                this.createParticleExplosion(this.player.x, this.player.y, 20, '#00ff00');
                this.updateHUD();
            }
            
            castTornado() {
                // Create tornado that moves forward
                const angle = Math.atan2(
                    this.mouse.y - this.canvas.height / 2,
                    this.mouse.x - this.canvas.width / 2
                );
                
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const tornado = {
                            x: this.player.x + Math.cos(angle) * i * 10,
                            y: this.player.y + Math.sin(angle) * i * 10,
                            width: 50,
                            height: 50
                        };
                        
                        this.enemies.forEach(enemy => {
                            if (this.checkCollision(tornado, enemy, 50)) {
                                this.damageEnemy(enemy, this.player.attack * 0.5);
                            }
                        });
                        
                        this.createParticles(tornado.x, tornado.y, 3, 'üå™Ô∏è');
                    }, i * 50);
                }
            }
            
            damageEnemy(enemy, damage) {
                enemy.hp -= damage;
                this.showDamageNumber(enemy.x, enemy.y, damage, '#ff0000');
                this.createParticles(enemy.x, enemy.y, 3, 'üí•');
            }
            
            damageBoss(boss, damage) {
                boss.hp -= damage;
                this.showDamageNumber(boss.x, boss.y, damage, '#ff6b00');
                this.createParticles(boss.x, boss.y, 5, 'üí•');
            }
            
            damagePlayer(damage) {
                if (this.player.invulnerable) return;
                
                const actualDamage = Math.max(1, damage - this.player.defense);
                this.player.hp -= actualDamage;
                this.player.invulnerable = true;
                this.player.invulnerableTime = 1000;
                
                this.showDamageNumber(this.player.x, this.player.y, actualDamage, '#ffffff');
                this.camera.shake = 8;
                this.createParticles(this.player.x, this.player.y, 5, 'üíî');
                
                if (this.player.hp <= 0) {
                    this.gameOver();
                }
                
                this.updateHUD();
            }
            
            collectItem(item) {
                switch(item.type) {
                    case 'üí∞':
                        this.player.gold += item.value;
                        this.updateQuest(2, item.value);
                        break;
                    case 'üíé':
                        this.player.gold += item.value * 2;
                        break;
                    case '‚≠ê':
                        this.gainExp(item.value);
                        break;
                    case 'üíä':
                        this.player.hp = Math.min(this.player.maxHp, this.player.hp + 20);
                        break;
                }
                
                this.createParticles(item.x, item.y, 8, item.type);
                this.updateHUD();
            }
            
            onEnemyKilled(enemy) {
                this.player.score += 100;
                this.gainExp(20 + this.player.level * 5);
                
                if (Math.random() < 0.3) {
                    this.items.push({
                        x: enemy.x,
                        y: enemy.y,
                        type: ['üí∞', 'üíé', '‚≠ê'][Math.floor(Math.random() * 3)],
                        value: 10 + Math.floor(Math.random() * 20)
                    });
                }
                
                this.updateQuest(1, 1);
                this.checkAchievement(1);
                this.createParticleExplosion(enemy.x, enemy.y, 20, '#ff00ff');
            }
            
            onBossKilled(boss) {
                this.player.score += 5000;
                this.gainExp(500);
                this.player.gold += 500;
                
                this.addChatMessage('üéâ Boss Defeated! Legendary loot!');
                
                for (let i = 0; i < 10; i++) {
                    this.items.push({
                        x: boss.x + (Math.random() - 0.5) * 100,
                        y: boss.y + (Math.random() - 0.5) * 100,
                        type: 'üíé',
                        value: 50
                    });
                }
                
                this.checkAchievement(4);
                this.createParticleExplosion(boss.x, boss.y, 50, '#ffd700');
                
                // Spawn next boss
                setTimeout(() => this.spawnBoss(), 60000);
            }
            
            gainExp(amount) {
                this.player.exp += amount;
                
                if (this.player.exp >= this.player.maxExp) {
                    this.levelUp();
                }
                
                this.updateHUD();
            }
            
            levelUp() {
                this.player.level++;
                this.player.exp = 0;
                this.player.maxExp = Math.floor(this.player.maxExp * 1.5);
                this.player.maxHp += 20;
                this.player.hp = this.player.maxHp;
                this.player.maxMp += 10;
                this.player.mp = this.player.maxMp;
                this.player.attack += 5;
                this.player.defense += 2;
                this.player.speed += 0.5;
                
                this.addChatMessage(`üéä Level Up! Now level ${this.player.level}!`);
                this.updateQuest(3, this.player.level);
                this.checkAchievement(3);
                this.createParticleExplosion(this.player.x, this.player.y, 30, '#ffd700');
                this.updateHUD();
            }
            
            updateQuest(questId, progress) {
                const quest = this.quests.find(q => q.id === questId);
                if (!quest || quest.complete) return;
                
                quest.progress += progress;
                
                if (quest.progress >= quest.target) {
                    quest.complete = true;
                    this.addChatMessage(`‚úÖ Quest Complete: ${quest.title}`);
                    this.player.gold += 100;
                    this.gainExp(100);
                }
                
                this.updateQuestLog();
            }
            
            checkAchievement(id) {
                const achievement = this.achievements.find(a => a.id === id);
                if (!achievement || achievement.unlocked) return;
                
                let unlock = false;
                
                switch(id) {
                    case 1: unlock = true; break;
                    case 2: unlock = this.player.gold >= 500; break;
                    case 3: unlock = this.player.level >= 10; break;
                    case 4: unlock = true; break;
                }
                
                if (unlock) {
                    achievement.unlocked = true;
                    this.showAchievement(achievement);
                }
            }
            
            showAchievement(achievement) {
                const popup = document.getElementById('achievementPopup');
                document.getElementById('achievementTitle').textContent = achievement.name;
                document.getElementById('achievementDesc').textContent = achievement.desc;
                popup.classList.add('show');
                
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3000);
            }
            
            selectInventorySlot(index) {
                this.player.selectedSlot = index;
                document.querySelectorAll('.inventory-slot').forEach((slot, i) => {
                    slot.classList.toggle('active', i === index);
                });
            }
            
            showDamageNumber(x, y, damage, color) {
                const div = document.createElement('div');
                div.className = 'damage-number';
                div.textContent = Math.floor(damage);
                div.style.left = (x - this.camera.x) + 'px';
                div.style.top = (y - this.camera.y) + 'px';
                div.style.color = color;
                document.body.appendChild(div);
                
                setTimeout(() => div.remove(), 1000);
            }
            
            createParticles(x, y, count, emoji) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 5,
                        vy: (Math.random() - 0.5) * 5,
                        life: 1000,
                        maxLife: 1000,
                        alpha: 1,
                        emoji: emoji,
                        size: 12 + Math.random() * 8
                    });
                }
            }
            
            createParticleExplosion(x, y, count, color) {
                for (let i = 0; i < count; i++) {
                    const angle = (Math.PI * 2 / count) * i;
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: Math.cos(angle) * (3 + Math.random() * 3),
                        vy: Math.sin(angle) * (3 + Math.random() * 3),
                        life: 800,
                        maxLife: 800,
                        alpha: 1,
                        color: color,
                        size: 4 + Math.random() * 4
                    });
                }
            }
            
            addChatMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                const div = document.createElement('div');
                div.className = 'chat-message';
                div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Keep only last 10 messages
                while (chatMessages.children.length > 10) {
                    chatMessages.removeChild(chatMessages.firstChild);
                }
            }
            
            updateQuestLog() {
                const questList = document.getElementById('questList');
                questList.innerHTML = '';
                
                this.quests.forEach(quest => {
                    const div = document.createElement('div');
                    div.className = 'quest-item';
                    if (quest.complete) div.style.opacity = '0.5';
                    
                    div.innerHTML = `
                        <div class="quest-title">${quest.complete ? '‚úÖ ' : ''}${quest.title}</div>
                        <div class="quest-progress">${quest.progress}/${quest.target}</div>
                    `;
                    
                    questList.appendChild(div);
                });
            }
            
            updateHUD() {
                document.getElementById('currentHP').textContent = Math.floor(this.player.hp);
                document.getElementById('maxHP').textContent = this.player.maxHp;
                document.getElementById('healthBar').style.width = (this.player.hp / this.player.maxHp * 100) + '%';
                
                document.getElementById('currentMP').textContent = Math.floor(this.player.mp);
                document.getElementById('maxMP').textContent = this.player.maxMp;
                document.getElementById('manaBar').style.width = (this.player.mp / this.player.maxMp * 100) + '%';
                
                document.getElementById('level').textContent = this.player.level;
                document.getElementById('currentExp').textContent = Math.floor(this.player.exp);
                document.getElementById('maxExp').textContent = this.player.maxExp;
                document.getElementById('expBar').style.width = (this.player.exp / this.player.maxExp * 100) + '%';
                
                document.getElementById('gold').textContent = this.player.gold;
                document.getElementById('attack').textContent = this.player.attack;
                document.getElementById('defense').textContent = this.player.defense;
                document.getElementById('speed').textContent = this.player.speed.toFixed(1);
                document.getElementById('score').textContent = this.player.score;
            }
            
            showBossHealthBar(boss) {
                document.getElementById('bossHealthBar').classList.remove('hidden');
                document.getElementById('bossName').textContent = boss.name;
                this.updateBossHealthBar(boss);
            }
            
            updateBossHealthBar(boss) {
                const percent = (boss.hp / boss.maxHp) * 100;
                document.getElementById('bossHealthFill').style.width = percent + '%';
            }
            
            render() {
                // Clear canvas
                this.ctx.fillStyle = '#1a1a2e';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw grid
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                this.ctx.lineWidth = 1;
                for (let x = 0; x < this.world.width; x += 50) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x - this.camera.x, 0);
                    this.ctx.lineTo(x - this.camera.x, this.canvas.height);
                    this.ctx.stroke();
                }
                for (let y = 0; y < this.world.height; y += 50) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y - this.camera.y);
                    this.ctx.lineTo(this.canvas.width, y - this.camera.y);
                    this.ctx.stroke();
                }
                
                // Draw obstacles
                this.obstacles.forEach(obs => {
                    this.ctx.fillStyle = obs.type === 'rock' ? '#666' : '#228B22';
                    this.ctx.fillRect(
                        obs.x - this.camera.x,
                        obs.y - this.camera.y,
                        obs.width,
                        obs.height
                    );
                });
                
                // Draw items
                this.items.forEach(item => {
                    this.ctx.font = '24px Arial';
                    this.ctx.fillText(
                        item.type,
                        item.x - this.camera.x - 12,
                        item.y - this.camera.y + 8
                    );
                });
                
                // Draw NPCs
                this.npcs.forEach(npc => {
                    this.ctx.font = '30px Arial';
                    this.ctx.fillText(
                        npc.type,
                        npc.x - this.camera.x - 15,
                        npc.y - this.camera.y + 10
                    );
                });
                
                // Draw enemies
                this.enemies.forEach(enemy => {
                    this.ctx.font = '30px Arial';
                    this.ctx.fillText(
                        enemy.type,
                        enemy.x - this.camera.x - 15,
                        enemy.y - this.camera.y + 10
                    );
                    
                    // Health bar
                    const barWidth = 40;
                    const barHeight = 5;
                    const hpPercent = enemy.hp / enemy.maxHp;
                    
                    this.ctx.fillStyle = '#ff0000';
                    this.ctx.fillRect(
                        enemy.x - this.camera.x - barWidth/2,
                        enemy.y - this.camera.y - 25,
                        barWidth,
                        barHeight
                    );
                    
                    this.ctx.fillStyle = '#00ff00';
                    this.ctx.fillRect(
                        enemy.x - this.camera.x - barWidth/2,
                        enemy.y - this.camera.y - 25,
                        barWidth * hpPercent,
                        barHeight
                    );
                });
                
                // Draw bosses
                this.bosses.forEach(boss => {
                    this.ctx.font = '60px Arial';
                    this.ctx.fillText(
                        boss.type,
                        boss.x - this.camera.x - 30,
                        boss.y - this.camera.y + 20
                    );
                    
                    // Boss glow effect
                    this.ctx.shadowBlur = 20;
                    this.ctx.shadowColor = boss.phase === 2 ? '#ff0000' : '#ffd700';
                    this.ctx.fillText(
                        boss.type,
                        boss.x - this.camera.x - 30,
                        boss.y - this.camera.y + 20
                    );
                    this.ctx.shadowBlur = 0;
                });
                
                // Draw projectiles
                this.projectiles.forEach(proj => {
                    this.ctx.font = '20px Arial';
                    this.ctx.fillText(
                        proj.type,
                        proj.x - this.camera.x - 10,
                        proj.y - this.camera.y + 7
                    );
                });
                
                // Draw particles
                this.particles.forEach(particle => {
                    this.ctx.globalAlpha = particle.alpha;
                    if (particle.emoji) {
                        this.ctx.font = particle.size + 'px Arial';
                        this.ctx.fillText(
                            particle.emoji,
                            particle.x - this.camera.x,
                            particle.y - this.camera.y
                        );
                    } else if (particle.color) {
                        this.ctx.fillStyle = particle.color;
                        this.ctx.beginPath();
                        this.ctx.arc(
                            particle.x - this.camera.x,
                            particle.y - this.camera.y,
                            particle.size,
                            0,
                            Math.PI * 2
                        );
                        this.ctx.fill();
                    }
                    this.ctx.globalAlpha = 1;
                });
                
                // Draw player
                this.ctx.save();
                if (this.player.invulnerable && Math.floor(Date.now() / 100) % 2) {
                    this.ctx.globalAlpha = 0.5;
                }
                this.ctx.font = '36px Arial';
                this.ctx.fillText(
                    'ü¶∏',
                    this.player.x - this.camera.x - 18,
                    this.player.y - this.camera.y + 12
                );
                this.ctx.restore();
                
                // Draw minimap
                this.renderMinimap();
            }
            
            renderMinimap() {
                const scale = 200 / this.world.width;
                
                // Background
                this.minimapCtx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.minimapCtx.fillRect(0, 0, 200, 200);
                
                // World bounds
                this.minimapCtx.strokeStyle = '#667eea';
                this.minimapCtx.strokeRect(0, 0, 200, 200);
                
                // Enemies
                this.minimapCtx.fillStyle = '#ff0000';
                this.enemies.forEach(enemy => {
                    this.minimapCtx.fillRect(
                        enemy.x * scale - 2,
                        enemy.y * scale - 2,
                        4, 4
                    );
                });
                
                // Bosses
                this.minimapCtx.fillStyle = '#ff00ff';
                this.bosses.forEach(boss => {
                    this.minimapCtx.fillRect(
                        boss.x * scale - 4,
                        boss.y * scale - 4,
                        8, 8
                    );
                });
                
                // Player
                this.minimapCtx.fillStyle = '#00ff00';
                this.minimapCtx.fillRect(
                    this.player.x * scale - 3,
                    this.player.y * scale - 3,
                    6, 6
                );
                
                // Camera view
                this.minimapCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                this.minimapCtx.strokeRect(
                    this.camera.x * scale,
                    this.camera.y * scale,
                    this.canvas.width * scale,
                    this.canvas.height * scale
                );
            }
            
            gameOver() {
                this.isRunning = false;
                this.addChatMessage('üíÄ Game Over!');
                
                setTimeout(() => {
                    if (confirm(`Game Over! Score: ${this.player.score}\nPlay again?`)) {
                        window.location.reload();
                    }
                }, 100);
            }
            
            showControls() {
                alert(`
üéÆ CONTROLS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Movement: WASD or Arrow Keys
Attack: Left Click / Space
Skills: Q, E, R, F, G
Inventory: 1-5
Pause: ESC

üí° TIPS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
- Collect items to get stronger
- Complete quests for rewards
- Defeat bosses for legendary loot
- Use skills strategically
- Watch your mana and health!
                `);
            }
            
            showSettings() {
                alert('‚öôÔ∏è Settings\n\nComing soon!');
            }
            
            showLeaderboard() {
                alert(`
üèÜ LEADERBOARD
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. Player1 - 99999
2. Player2 - 85000
3. Player3 - 72000
4. Player4 - 65000
5. YOU - ${this.player.score}

Keep playing to climb the ranks!
                `);
            }
        }
        
        // Initialize game
        const game = new UltimateGame();
        
        // Make game accessible globally
        window.game = game;
        
        console.log('%cüéÆ THE ULTIMATE GAME LOADED! üéÆ', 'color: #667eea; font-size: 20px; font-weight: bold;');
        console.log('%cPress F12 to see advanced stats!', 'color: #4ecdc4;');
    </script>
</body>
</html>
